!function(e){var t={};function s(i){if(t[i])return t[i].exports;var a=t[i]={i:i,l:!1,exports:{}};return e[i].call(a.exports,a,a.exports,s),a.l=!0,a.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="",s(s.s=37)}({37:function(e,t,s){e.exports=s(38)},38:function(e,t){var s=$("meta[name=ws_url]").attr("content"),i=$("meta[name=ws_asset]").attr("content"),a=Number($("meta[name=user_id]").attr("content")),n=io(s,{query:"id= "+a}),o=new Vue({el:"#chatApp",data:{user_id:a,chatLists:[],chatBox:[],socketConnected:{status:!1,msg:"Connecting Please Wait..."},bArr:{}},methods:{chat:function(e){if(this.chatBox.includes(e.id)){var t=this.chatBox.indexOf(e.id);this.chatBox.splice(t,1),this.chatBox.unshift(e.id),$("#msginput-"+e.id).focus()}else{e.msgCount=0;var s=new(Vue.extend(c))({propsData:{socket:n,user_id:this.user_id,cChat:e,chatBoxClose:this.chatBoxClose,chatBoxMinimize:this.chatBoxMinimize}}).$mount();$("body").append(s.$el),this.bArr[e.id]=s,this.chatBox.unshift(e.id),$("#msginput-"+e.id).focus()}this.calcChatBoxStyle()},chatBoxClose:function(e){$("#chatbox-"+e).remove(),this.bArr[e].$destroy();var t=this.chatBox.indexOf(e);this.chatBox.splice(t,1),this.calcChatBoxStyle()},chatBoxMinimize:function(e){$("#chatbox-"+e+" .box-body, #chatbox-"+e+" .box-footer").slideToggle("slow")},calcChatBoxStyle:function(){var e=270;this.chatBox.filter(function(t,s){s<4?($("#chatbox-"+t).css("right",e).show(),e+=260):$("#chatbox-"+t).hide()})}}});n.on("connect",function(e){o.socketConnected.status=!0,n.emit("chatList",o.user_id)}),n.on("connect_error",function(){o.socketConnected.status=!1,o.socketConnected.msg="Could not connect to server",o.chatLists=[]}),n.on("chatListRes",function(e){e.userDisconnected?o.chatLists.findIndex(function(t){t.socket_id==e.socket_id&&(t.online="N",t.socket_id="")}):e.userConnected?o.chatLists.findIndex(function(t){t.id==e.userId&&(t.online="Y",t.socket_id=e.socket_id)}):(e.chatList.findIndex(function(e){e.msgCount=0}),o.chatLists=e.chatList)}),n.on("addMessageResponse",function(e){o.chatBox.includes(e.fromUserId)||o.chatLists.findIndex(function(t){t.id==e.fromUserId&&(t.msgCount+=1)})});var c={data:function(){return{messages:[],message:"",typing:"",timeout:""}},props:["user_id","cChat","socket","chatBoxClose","chatBoxMinimize"],mounted:function(){n.emit("getMessages",{fromUserId:this.user_id,toUserId:this.cChat.id}),n.on("getMessagesResponse",this.getMessagesResponse),n.on("addMessageResponse",this.addMessageResponse),n.on("typing",this.typingListener),n.on("image-uploaded",this.imageuploaded)},destroyed:function(){n.removeListener("getMessagesResponse",this.getMessagesResponse),n.removeListener("addMessageResponse",this.addMessageResponse),n.removeListener("typing",this.typingListener)},methods:{sendMessage:function(e){if(13===e.keyCode)if(this.message.length>0){var t=this.createMsgObj("text","",this.message);this.socket.emit("addMessage",t),this.messages.push(t),this.message="",this.scrollToBottom()}else alert("Please Enter Your Message.");else 116==e.keyCode||82==e.keyCode||e.ctrlKey||(this.socket.emit("typing",{typing:"typing...",socket_id:this.cChat.socket_id}),clearTimeout(this.timeout),this.timeout=setTimeout(this.timeoutFunction,500))},timeoutFunction:function(){n.emit("typing",{typing:!1,socket_id:this.cChat.socket_id})},scrollToBottom:function(){$("#chatboxscroll-"+this.cChat.id).stop().animate({scrollTop:$("#chatboxscroll-"+this.cChat.id)[0].scrollHeight},1)},createMsgObj:function(e,t,s){return{type:e,fileFormat:t,filePath:"",fromUserId:this.user_id,toUserId:this.cChat.id,toSocketId:this.cChat.socket_id,message:s,time:(new moment).format("hh:mm A"),date:(new moment).format("Y-MM-D")}},addMessageResponse:function(e){e&&e.fromUserId==this.cChat.id&&(this.messages.push(e),this.scrollToBottom())},typingListener:function(e){e.typing&&e.to_socket_id==this.cChat.socket_id?this.typing="is "+e.typing:this.typing=""},getMessagesResponse:function(e){e.toUserId==this.cChat.id&&(this.messages=e.result,this.$nextTick(function(){this.scrollToBottom()}))},imageuploaded:function(e){e&&e.toUserId==this.cChat.id&&($(".overlay").parent().parent().remove(),this.messages.push(e),this.scrollToBottom())},file:function(e){var t=e.target.files[0];if(this.validateSize(t)){var s=t.type.split("/")[0],i=new FileReader;i.onload=function(){var e=this.createMsgObj("file",s,i.result);if(e.fileName=t.name,n.emit("upload-image",e),e.type="text","image"!=s)e.message='<span class="info-box-icon bg-primary" style="color: white;background:none;"><i class="fa fa-paperclip"></i></span><div class="overlay"><i style="color:#fff" class="fa fa-refresh fa-spin"></i></div>';else{var a=URL.createObjectURL(new Blob([i.result]));e.message='<img height="100px;" width="100px;" src="'+a+'"><div class="overlay"><i style="color:#fff" class="fa fa-refresh fa-spin"></i></div>'}this.messages.push(e),this.scrollToBottom()}.bind(this),i.readAsArrayBuffer(t)}else e.target.value="",alert("File size exceeds 10 MB")},validateSize:function(e){return!(e.size/1024/1024>10)}},filters:{dateFormat:function(e){return new moment(e).format("D-MMM-YY")}},template:'\n        <div class="chat_box" v-bind:id="\'chatbox-\' + cChat.id" style="right:270px">\n            <div class="box box-primary direct-chat direct-chat-primary">\n                <div class="box-header with-border">\n                    <h3 class="box-title">{{ cChat.name }}</h3> <span>{{ typing }}</span>\n                    <div class="box-tools pull-right">\n                        <button type="button" class="btn btn-box-tool" data-widget="collapse" @click="chatBoxMinimize(cChat.id)"><i class="fa fa-minus"></i>\n                        </button>\n                        <button type="button" class="btn btn-box-tool" @click="chatBoxClose(cChat.id)"><i class="fa fa-times"></i>\n                        </button>\n                    </div>\n                </div>\n\n                \x3c!-- /.box-header --\x3e\n                <div style="" class="box-body">\n                    <div class="direct-chat-messages" v-bind:id="\'chatboxscroll-\' + cChat.id">\n                        <div v-for="messagePacket in messages" class="direct-chat-msg" v-bind:class="{ \'right\' : (messagePacket.fromUserId == user_id) }">\n                            <div class="direct-chat-info clearfix">\n                                <small class="direct-chat-timestamp"  v-bind:class="{ \'pull-right\' : (messagePacket.fromUserId == user_id), \'pull-left\' : (messagePacket.fromUserId != user_id) }">{{ messagePacket.date | dateFormat }},{{ messagePacket.time }}</small>\n                            </div>\n\n                            <div v-if="messagePacket.type == \'text\'" v-bind:class="{ \'pull-right\' : (messagePacket.fromUserId == user_id), \'pull-left\' : (messagePacket.fromUserId != user_id) }" v-html=messagePacket.message class="direct-chat-text clearfix" style="margin-right: 1px;margin-left: 1px;word-break: break-all;padding: 3px 10px;">\n                            </div>\n\n                            <div v-if="messagePacket.type == \'file\'" v-bind:class="{ \'pull-right\' : (messagePacket.fromUserId == user_id), \'pull-left\' : (messagePacket.fromUserId != user_id) }" class="direct-chat-text clearfix" style="margin-right: 1px;margin-left: 1px;word-break: break-all;padding: 3px 3px;">\n                                <a v-if="messagePacket.fileFormat == \'image\'" :href="\''+i+'\' + messagePacket.filePath" download :title="messagePacket.message" target="_new"><img height="110px;" width="110px;" :src="\''+i+"' + messagePacket.filePath\"></a>\n                                <a v-else :href=\"'"+i+'\' + messagePacket.filePath" download :title="messagePacket.message" target="_new"><span class="info-box-icon" style="color: white;background:none;"><i class="fa fa-paperclip"></i></span>\n                                </a>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div style="display: block;" class="box-footer">\n                    <div class="input-group">\n                        <input name="message" v-bind:id="\'msginput-\' + cChat.id" v-model.trim="message" placeholder="Type Message And Hit Enter" class="form-control" type="text" v-on:keydown="sendMessage($event)">\n                        <span class="input-group-btn">\n                            <div class="btn btn-default btn-file">\n                                <i class="fa fa-paperclip"></i>\n                                <input name="attachment" type="file" v-on:change="file($event)">\n                            </div>\n                        </span>\n                    </div>\n                </div>\n            </div>\n        </div>'}}});